This is a continuation of the previous lesson [[3.02 Generate weekly sales report - Date Diff, Flatten Data, Filter Last 7 days]].

We have filtered in salespersons who closed a sales in the last 7 days from the "Today" date.

Now we will transform the data into something report worthy.

This is what we have so far:
![[Pasted image 20250611025349.png]]


---

Let's explore if Aggregate node is useful for our sales reports

Add Aggregate after the Filter:
![[Pasted image 20250611055832.png]]

---

### Explore Aggregate

Before we make a proper aggregate node, let's explore what aggregate can do as a node.

Keep in mind that our data that Aggregate will modify is:
```
[
  {
    "salesperson": "Alice",
    "region": "West",
    "amount": 500,
    "date": "2025-06-08",
    "dayDifference": 2
  },
  {
    "salesperson": "Bob",
    "region": "East",
    "amount": 300,
    "date": "2025-06-05",
    "dayDifference": 5
  },
  {
    "salesperson": "Charlie",
    "region": "North",
    "amount": 750,
    "date": "2025-06-09",
    "dayDifference": 1
  },
  {
    "salesperson": "Diana",
    "region": "South",
    "amount": 320,
    "date": "2025-06-07",
    "dayDifference": 3
  },
  {
    "salesperson": "Alice",
    "region": "West",
    "amount": 180,
    "date": "2025-06-06",
    "dayDifference": 4
  },
  // ...
]
```

>[!note] Aggregate can extract values of key A into a single array under a key A
> Aggregate Individual Field "amount". Now everyone's amounts earned will be saved as an array under the proeprty "amount"
> ![[Pasted image 20250611052902.png]]
> 
> ^ And if you had added more fields to aggregate? The object will contain another array property:
> - Notice that there are two Alice in inputs and there are two Alice in outputs. Aggregate in this form just extract values - it does not collapse duplicates.
> ![[Pasted image 20250611053652.png]]
> 

> [!note] Aggregate to remove fields
> 
> Let's change Aggregate mode to: All Item Data (Into a Single List)
> 
> Notice here Aggregate "Includes" fields you want to keep. The "Includes" field is set to "Specified Fields"
> 
> After executing this step, the data structure is maintained except it's nested deeper. We leave the "Put Output in Field" input empty for now:
> ![[Pasted image 20250611054116.png]]
> 
> ^The nested structure is difficult to parse for later nodes. That's where "Put Output in Field" comes in. You wrap the deeper data structure with a key. That's the correct way. n8n probably overlooked checking if you had typed into "Put Output in Field": 
> ![[Pasted image 20250611054217.png]]
>
> What if for Include, we choose the opposite for "Includes" field: "All Fields Except". As long as we list the other fields instead, we get the same result:
> ![[Pasted image 20250611054506.png]]
> 
> **TLDR:**
> In other words, you can aggregate a property that all the sales objects share into a single array. Or you can aggregate all sales objects into an array. Either way, the array is stored under a property because in JS object format, all data must be named under a key.

Aggregate is useless for sales reports then. Lets swap it out for another node we can explore.

This is not a continuation of code from the previous lesson. This is just a read-over. In the future we will have actual code walkthrough.

---

Most plugins need a place for configuration: API keys, feature toggles, defaults, etc. In WordPress, the standard approach is to create an **admin settings page** and use the **Settings API** to safely store values in `wp_options`. It’s also common to add a **Settings** shortcut link directly on the **Plugins list** screen for quick access.

This tutorial shows a clean, minimal setup you can paste into a plugin and expand.

---

## What You’ll Build

- A settings page in wp-admin
    
- A saved option in `wp_options` via the Settings API
    
- A **Settings** link visible on the **Plugins** list row
    
- A brief note on placing the page as:
    
    - a top-level left sidebar item, or
        
    - a Tools submenu item
        

---

## 1) Create the Admin Settings Page

You first need to register a page in the WordPress admin menu and render its HTML.

### Settings menu location

Using `add_options_page()` places your plugin under **Settings**.

```php
defined('ABSPATH') || exit;

add_action('admin_menu', 'myplugin_register_settings_page');

function myplugin_register_settings_page() {
  add_options_page(
    'My Plugin Settings',        // Page title
    'My Plugin',                 // Menu title
    'manage_options',            // Capability required
    'myplugin-settings',         // Menu slug
    'myplugin_render_settings_page' // Render callback
  );
}

function myplugin_render_settings_page() {
  if (!current_user_can('manage_options')) return;
  ?>
  <div class="wrap">
    <h1>My Plugin Settings</h1>

    <form method="post" action="options.php">
      <?php
        settings_fields('myplugin_settings_group'); // Nonce + hidden fields
        do_settings_sections('myplugin-settings');  // Sections + fields output
        submit_button();
      ?>
    </form>
  </div>
  <?php
}
```

After this, you’ll see your menu item under **Settings** and the page will load—but it won’t save anything until you register settings.

---

## 2) Register and Save Values with the Settings API

The Settings API handles:

- storing values in `wp_options`,
    
- permissions checks, and
    
- sanitization.
    

A convenient pattern is storing everything in **one array option** (e.g. `myplugin_settings`).

```php
add_action('admin_init', 'myplugin_register_settings');

function myplugin_register_settings() {
  // Register a single option array
  register_setting(
    'myplugin_settings_group', // option group (matches settings_fields)
    'myplugin_settings',       // option name in wp_options
    [
      'type'              => 'array',
      'sanitize_callback' => 'myplugin_sanitize_settings',
      'default'           => [],
    ]
  );

  // Add a section
  add_settings_section(
    'myplugin_main_section',
    'General',
    function () {
      echo '<p>Configure the plugin behavior.</p>';
    },
    'myplugin-settings'
  );

  // Add a field (API Key example)
  add_settings_field(
    'api_key',
    'API Key',
    'myplugin_render_api_key_field',
    'myplugin-settings',
    'myplugin_main_section'
  );
}

function myplugin_render_api_key_field() {
  $opts  = get_option('myplugin_settings', []);
  $value = $opts['api_key'] ?? '';
  ?>
  <input
    type="text"
    class="regular-text"
    name="myplugin_settings[api_key]"
    value="<?php echo esc_attr($value); ?>"
  />
  <p class="description">Paste your API key.</p>
  <?php
}

function myplugin_sanitize_settings($input) {
  $output = [];

  $output['api_key'] = isset($input['api_key'])
    ? sanitize_text_field($input['api_key'])
    : '';

  return $output;
}
```

Now when you click **Save Changes**, WordPress will store the option.

---

## 3) Read the Settings Anywhere in Your Plugin

Once saved, you can access settings like this:

```php
$opts    = get_option('myplugin_settings', []);
$api_key = $opts['api_key'] ?? '';
```

---

## 4) Add a “Settings” Link on the Plugins List Screen

To add a **Settings** link beside “Deactivate” on `wp-admin/plugins.php`, use `plugin_action_links`.

```php
add_filter('plugin_action_links', 'myplugin_add_settings_link', 10, 2);

function myplugin_add_settings_link($links, $file) {
  // Best practice: compare against your plugin's basename.
  // If this code is inside your main plugin file, this works:
  $my_plugin_file = plugin_basename(__FILE__);

  if ($file !== $my_plugin_file) return $links;

  // Settings page under Settings:
  $settings_url = admin_url('options-general.php?page=myplugin-settings');

  $settings_link = '<a href="' . esc_url($settings_url) . '">Settings</a>';
  array_unshift($links, $settings_link);

  return $links;
}
```

### Important note if your plugin isn’t a single file

If the filter code lives in an included file, `plugin_basename(__FILE__)` won’t match the plugin row.

In that case, hardcode the main plugin file basename:

```php
$my_plugin_file = 'my-plugin/my-plugin.php';
```

---

## 5) If Your Settings Page Lives Under Tools, Use the Correct URL

If you add your page under **Tools**, the correct admin URL becomes:

```php
admin_url('tools.php?page=myplugin-settings')
```

That’s important for the Plugins list “Settings” shortcut.

---

## Final Section: Other Menu Locations (Top-Level Sidebar or Tools)

Sometimes a plugin doesn’t belong under Settings. Here are the two common alternatives.

### A) Make it a top-level left sidebar item

Use `add_menu_page()`:

```php
add_action('admin_menu', function () {
  add_menu_page(
    'My Plugin Settings',     // Page title
    'My Plugin',              // Menu title
    'manage_options',         // Capability
    'myplugin-settings',      // Menu slug
    'myplugin_render_settings_page',
    'dashicons-admin-generic',
    65
  );
});
```

### B) Add it under Tools

You can use either helper:

**Option 1: `add_management_page()`**

```php
add_action('admin_menu', function () {
  add_management_page(
    'My Plugin Settings',
    'My Plugin',
    'manage_options',
    'myplugin-settings',
    'myplugin_render_settings_page'
  );
});
```

**Option 2: `add_submenu_page()` (explicit parent slug)**

```php
add_action('admin_menu', function () {
  add_submenu_page(
    'tools.php',                 // Parent slug = Tools
    'My Plugin Settings',
    'My Plugin',
    'manage_options',
    'myplugin-settings',
    'myplugin_render_settings_page'
  );
});
```

Either way, your Settings API code stays the same—the only change is _where_ the page appears in the admin menu.